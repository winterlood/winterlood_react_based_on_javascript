# API 호출하기

안녕하세요 winterlood입니다.

드디어 3섹션의 마지막 챕터입니다.

이번시간에 우리가 마지막으로 배워볼 자바스크립트 응용은 `API`호출 입니다.

사실상 우리가 이전 시간에 함께 배웠던 `비동기 처리`관련 테크닉들과

이번시간에 배울 `API`호출 까지 모두 학습 하신다면

여러분은 자바스크립트로 할 수 있는 여러가지 애플리케이션들을 직접 개발하고 운영해보실 수 있을겁니다.

자 그러면 드디어 자바스크립트 학습 목표의 마지막 `API` 호출에 대해 이야기 해 보도록 하겠습니다.

## 01. API란?

`API`라는것은 무엇일까요?

`API`라는 단어의 정의에 대해 위키백과에 찾아보면 이렇게 나옵니다.

API란 응용 프로그램 프로그래밍 인터페이스라고 하는 굉장히 복잡하고 심오한 뜻을 가지고 있습니다.

자 근데 이게 도대체 무슨뜻일까요?

이 설명을 단번에 보고 이해할 만큼 비범한 사람은 아마 없을겁니다.

일단 확실한건 저를 포함해서 제 주위에는 아무도 없습니다.

자 그러면 아주 쉽게 `API`에 대해 이야기 해보도록 하겠습니다.

### 1-1. 레스토랑

우선 레스토랑을 생각해보겠습니다.

이 레스토랑을 방문하는 손님은 음식을 먹으려면 4가지 단계를 거칩니다.

1. 손님이 음식을 서빙하는 웨이터에게 음식을 주문합니다.

2. 음식을 주문하면, 웨이터는 주방의 냉장고에서 적절한 음식이 있는지 찾습니다.

3. 웨이터는 적절한 음식을 냉장고에서 꺼냅니다.

4. 꺼낸 음식을 나름대로 조리하여 손님에게 전달(서빙)합니다.

자 이 과정은 놀랍게도, 우리가 웹사이트를 통해 어떤 정보를 보는 방식과 비슷합니다.

### 1-2. 레스토랑 vs 웹

손님이 웨이터에게 음식을 주문하고 받아보는 것 처럼

우리가 웹사이트로 어떤 정보를 본다는 것은, 크롬과 같은 웹 브라우저가 어떠한 서버에 데이터를 요청하고 응답받은 데이터를 사용합니다.

한번에 확 비교하려니 조금 어렵고 복잡하게 다가오실 수 있으니

레스토랑과 웹 구동방식이 어떻게 비슷한지

디테일하게 하나하나씩 분석해보도록 하겠습니다.

### 1-3. 레스토랑 -> 등장인물 비교

우선 등장인물부터 비교해보겠습니다.

레스토랑의 3가지 등장인물인 손님과 웨이터 그리고 냉장고는 이렇게 바꿔볼 수 있습니다.

손님은 음식을 요청하는 것 처럼 데이터를 요청하는 `Client`

웨이터는 음식을 서빙하듯 데이터를 요청받은 데이터를 전달해주니 `Server`

마지막으로 냉장고는 음식들이 보관되어있는 것 처럼 데이터들이 보관되어있으니까 `Database`에 비유할 수 있습니다.

### 1-4. 레스토랑 -> 등장인물 비교

등장인물을 비교해보았으니 이제 상호작용도 비교해보겠습니다.

음식을 데이터와 똑같다고 생각하고 비교해볼게요

1. 첫번째로 Client가 Server에게 음식을 주문하는건 데이터를 요청하는 것 과 똑같습니다. 이것을 보통 요청(`Request`)라고 표현합니다.

2. 두번째로 서버가 냉장고에서 음식을 찾는건, 데이터베이스에서 데이터를 원하는 데이터를 얻기 위해 검색 즉 질의하는 것 과 똑같습니다. 이것은 보통 데이터 질의(`Query`) 라고 표현합니다.

3. 세번째로 냉장고에서 적절한 음식을 꺼내는 것은, 데이터베이스에 데이터를 질의한 결과를 받아보는 것과 똑같습니다.

4. 마지막으로, 서버가 클라이언트에게 음식을 서빙하는 행위는 1번에서 요청한 데이터를 최종적으로 전달하는 과정과 똑같습니다. 이것은 요청에 대한 응답이므로 `Response`라고 표현합니다.

어떤가요? 처음보다는 조금 더 이해가 된 느낌인가요?

### 1-5. 정리

자 우리가 자바스크립트로 개발하는 부분은 저 세가지 등장인물 중 손님인 `Client`입니다.

이 `Client`의 관점에서 우리는 두개만 알면 됩니다.

첫번째는 데이터를 요청하는 것이고, 두번째는 요청한 데이터를 받는겁니다.

이렇게 웹브라우저를 통해 서버에게 데이터를 요청하고 전달받는 이 과정을 `API`호출이라고 부릅니다.

결국 `API`라는 건 쉽게말해, 클라이언트와 서버처럼 프로그램과 프로그램간의 연결 다리이자 대화를 할 수 있는 방법 정도로 볼 수 있겠습니다.

마지막으로 정리하자면 `API`호출은 다른 프로그램에게 대화를 건다고 생각할 수 있겠습니다.

## 02. API와 비동기?

결국 `API`호출은 어떤 데이터를 반환받기 위한 목적을 가지고 있습니다.

어떻게 보면 이 `API`호출은 함수랑 비슷합니다. 이 함수도 호출해서 원하는 데이터를 반환하게 할 수 있었습니다.

그런데 이 `API`호출이 함수와 가지는 큰 차이점 한가지는 언제 응답받을지 모른다는 점 입니다.

이 `API` 호출은 항상 우리 컴퓨터안에서 일어나는 일이 아닙니다. 다른 컴퓨터의 서버 프로그램에 요청하는 경우가 많고

그 서버에서 요청한 데이터를 응답해줄 때 까지의 시간은 인터넷 연결속도, 서버의 부하상태 등등의 요소로 인해 예상할 수 없고 때로는 실패하기도 합니다.

언제 끝날지 모르는 작업을 모두 다 동기적으로 처리할수는 없겠죠, 그래서 이런 `API`호출에는 `Promise`객체를 이용하여 비동기 호출을 하게 됩니다.

## 03. fetch

이제 `API`호출이 무엇이고, 왜 필요한지 이야기 해보았으니

드디어 지금부터 특정 서버에 데이터를 요청하고 받아보는 `API`호출을 직접 수행 해 보도록 하겠습니다.

그 전에 `API` 호출에 아무 조건없이 응답해줄 서버가 필요합니다.

그러나 우리가 아무한테나 말건다고 다 대답해주지는 않는 것 처럼 `API`도 인증된 어떤 누군가에 한해 대답을 하는 경우가 대다수입니다.

이럴때는 `jsonplaceholder`, 무료로 아무 조건없이 `API`호출을 받아주는 서비스를 이용하면 됩니다.

이렇게 별 조건없이 무료로 공개해놓은 `API`들을 `openAPI`라고 부릅니다.

아무튼, 이 사이트에 접속해서 쭉 살펴보시면 자원(`Resources`)탭에 여러가지 하이퍼링크가 있는 걸 볼 수 있는데요

`/posts`를 클릭해보도록 하겠습니다.

자 그러면 `https://jsonplaceholder.typicode.com/posts` 이런 주소로 이동하고 `json`형식의 데이터가 웹브라우저에 쫙 뿌려지는 걸 볼 수 있습니다.

이 주소는 `API`를 호출하는 주소이고, 웹 브라우저로 접속했을 때 `json`형식으로 나타나는 이 데이터들은 `API`호출의 응답 결과인 `Response`입니다.

그럼 실제로 이 `API`를 호출해보도록 할게요

```javascript
let response = fetch("https://jsonplaceholder.typicode.com/posts").then(
  (response) => console.log(response)
);
```

자바스크립트에는 `fetch`라는 `API`호출을 도와주는 내장함수가 존재합니다.

이 `fetch`의 파라미터에는 요청 주소를 넣어야 하는데요 우리가 아까 사용하기로 결정한 `jsonplaceholder`의 `/posts`를 주소로 넣어주도록 하겠습니다.

이 `fetch`는 `API`를 호출하는 용도로 사용되기 때문에 `Promise`를 반환하여 비동기 처리를 합니다.

따라서 우리는 `API`호출 결과를 `then`메서드를 통하여 전달받아 이런식으로 호출해서 사용할 수 있습니다.

결과는 아래와 같습니다

```javascript
Response {type: "cors", url: "https://jsonplaceholder.typicode.com/posts", redirected: false, status: 200, ok: true…}
```

무슨 이상한 결과가 나왔습니다, 이것은 요청에 대한 응답이 성공했는지 어떻게 왔는지 등에 대한 정보까지 같이 담겨져있기 때문입니다

이번에는 그러면 우리가 정말 필요로했던, 요청에 대한 순수한 응답 데이터만 사용하기 위해 `json`형태로 파싱하여 사용하겠습니다.

이번에는 `await`와 `async`까지 함께 사용해서 더 직관적으로 만들어 보도록 하겠습니다.

```javascript
const getData = async () => {
  const rawResponse = await fetch("https://jsonplaceholder.typicode.com/posts");
  const responseData = await rawResponse.json();
  console.log(responseData);
};

getData();
```

자 이렇게 `API`가 무엇이고 자바스크립트에서는 어떻게 사용할 수 있는지 까지 모두 알아보았습니다.

이렇게 두 섹션에 이은 자바스크립트 기본과 응용에 대한 학습은 드디어 종료되었습니다.

정말 고생 많으셨습니다.

저는 다음 챕터에서 인사드리도록 하겠습니다.

감사합니다.
